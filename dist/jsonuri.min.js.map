{"version":3,"sources":["jsonuri.js"],"names":["global","factory","exports","module","define","amd","safeTrim","this","noop","isInteger","num","Number","isObject","val","Object","prototype","toString","call","isArray","objectForeach","obj","callback","keys","forEach","prop","normalizePath","_len","arguments","length","path","Array","_key","arrPro","concat","apply","join","split","combingPathKey","walk","_walk","key","raw","push","descentionFn","pop","ascentionFn","undefined","indexOf","filter","item","slice","_i","splice","_i2","_i3","JsonUri","data","value","String","cur","i","_nextKey","_curType","get","set","rm","tmp","swap","pathA","pathB","_a","_b","mv","direction","aParent","bParent","aIndex","bIndex","insert","up","gap","parent","index","targetIndex","console","error","down","isAfter","target","min","max","Math","defineProperty"],"mappings":"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","file":"jsonuri.min.js","sourcesContent":["/*!\n * jsonuri v2.0.0\n * (c) 2016 Linkjun <pk.link@163.com>\n * Released under the MIT License.\n */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.safeTrim = global.safeTrim || {})));\n}(this, (function (exports) { 'use strict';\n\nfunction noop() {}\n\nfunction isInteger(num) {\n  return Number.isInteger(num);\n}\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\nfunction isArray(val) {\n  return Object.prototype.toString.call(val) === '[object Array]';\n}\n\nfunction objectForeach(obj, callback) {\n  Object.keys(obj).forEach(function (prop) {\n    callback(obj[prop], prop, obj);\n  });\n  return obj;\n}\n\nvar arrPro = Array.prototype;\nfunction normalizePath() {\n  for (var _len = arguments.length, path = Array(_len), _key = 0; _key < _len; _key++) {\n    path[_key] = arguments[_key];\n  }\n\n  //path = isArray(path) ? path : [path]\n  path = arrPro.concat.apply(arrPro, path).join('/').split('/');\n  path = ['/', combingPathKey(path).join('/')].join('');\n  if (path !== '/') {\n    path += '/';\n  }\n  return path;\n}\n\n/**\n * [walk description] 遍历一个对象, 提供入栈和出栈两个回调, 操作原对象\n * @param  {object} obj          [description]\n * @param  {[type]} descentionFn [description]\n * @param  {[type]} ascentionFn  [description]\n * @return {[type]}              [description]\n */\nfunction walk() {\n  var obj = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n  var descentionFn = arguments.length <= 1 || arguments[1] === undefined ? noop : arguments[1];\n  var ascentionFn = arguments.length <= 2 || arguments[2] === undefined ? noop : arguments[2];\n\n  var path = [];\n\n  function _walk(obj) {\n    objectForeach(obj, function (val, key, raw) {\n      path.push(key);\n      descentionFn(val, key, raw, { path: normalizePath(path) });\n      path.pop();\n      if (val instanceof Object) {\n        path.push(key);\n        _walk(val);\n        path.pop();\n        ascentionFn(val, key, raw, { path: normalizePath(path) });\n      }\n    });\n    return obj;\n  }\n\n  return _walk(obj);\n}\n\nfunction indexOf(path) {\n  return path.split('/').filter(function (item) {\n    return item;\n  }).slice(-1)[0] - 0;\n}\n\n/**\n * Combing path keys\n * @param  {Array} keys  ['','menu','id','','.']\n * @return {Array}       ['menu','id']\n */\nfunction combingPathKey(keys) {\n  // {empty}\n  while (~keys.indexOf('')) {\n    var _i = keys.indexOf('');\n    keys.splice(_i, 1);\n  }\n\n  // .\n  while (~keys.indexOf('.')) {\n    var _i2 = keys.indexOf('.');\n    keys.splice(_i2, 1);\n  }\n\n  // ..\n  while (~keys.indexOf('..')) {\n    var _i3 = keys.indexOf('..');\n    keys[_i3] = keys[_i3 - 1] = null;\n    delete keys[_i3];\n    delete keys[_i3 - 1];\n    keys.splice(_i3, 1);\n    keys.splice(_i3 - 1, 1);\n  }\n\n  return keys;\n}\n\n/**\n * JsonUri\n * @author Linkjun\n * @param {Object | Array}    data  {k:1,s:[..]}\n * @param {String}            path  '/s/0/'\n * @param {Any}               value [0,{s:0},2,3,4]\n */\nfunction JsonUri(data, path, value) {\n  //Data must be Object.\n  if (!(data instanceof Object)) return;\n\n  //Path must be valid.\n  if (!path) return data;\n\n  //Combing Path Key.\n  var keys = combingPathKey(String(path).split('/'));\n  //Initialize data to the pointer.\n  var cur = data;\n\n  for (var i = 0; i < keys.length; i++) {\n    //Key must be valid.\n    if (!keys[i]) continue;\n\n    if (i === keys.length - 1) {\n      if (value !== undefined) {\n        //set value.\n        cur[keys[i]] = value;\n      } else if (value === null) {\n        //delete value in the object.\n        if (isObject(cur)) {\n          cur[keys[i]] = null;\n          delete cur[keys[i]];\n        }\n\n        //delete value in the array.\n        if (isArray(cur)) {\n          cur[keys[i]] = null;\n          cur.splice(keys[i], 1);\n        }\n      }\n    } else if (value) {\n      //if set value\n      var _nextKey = keys[i + 1];\n\n      //curData is undefined.\n      if (!cur[keys[i]]) {\n        //create data container.\n        var _curType = _nextKey * 0 === 0 ? 'Array' : 'Object';\n        if (_curType === 'Array') {\n          cur[keys[i]] = [];\n        } else if (_curType === 'Object') {\n          cur[keys[i]] = {};\n        }\n      }\n    } else {\n      if (cur[keys[i]] === undefined) {\n        //Data path is undefined and return.\n        return undefined;\n      } else if (cur[keys[i]] === null) {\n        return null;\n      }\n    }\n\n    cur = cur[keys[i]];\n  }\n\n  return cur;\n}\n\n/**\n * JsonUri\n * @author Linkjun @linkjun.com\n * @description\n *   get(data, '/menu/id/');\n *   get(data, '/menu/id/../');\n *   get(data, '/menu/id/.../');\n *   get(data, '/menu/id/~/');\n *   set(data, '/menu/id/',[0,1,2,3,4]);\n *   mv(data, '/menu/id/0', '/menu/id/2');\n *   swap(data, '/menu/id/0', '/menu/id/1');\n *   rm(data, '/menu/value/');\n */\n\n/**\n * require isObject,\n *         isArray,\n *         arrayMove\n */\n/**\n * Get\n * @param  {Object} data  typeof Object or Array.\n * @param  {String} path  ex: '/menu/nav/list'.\n * @param {[type]}        return value.\n */\nfunction get(data, path) {\n  return JsonUri(data, path);\n}\n\n/**\n * Set\n * @param  {Object} data  typeof Object or Array.\n * @param  {String} path  ex: '/menu/nav/list'.\n * @param  {Any}    value ex: {}.\n * @param {[type]}        return data this.\n */\nfunction set(data, path, value) {\n  JsonUri(data, path, value);\n  return data;\n}\n\n/**\n * Remove\n * @param  {Object} data  typeof Object or Array.\n * @param  {String} path  ex: '/menu/nav/list'.\n * @return {Any}          The deleted value.\n */\nfunction rm(data, path) {\n  var tmp = JsonUri(data, path);\n  set(data, path, null);\n  return tmp;\n}\n\n/**\n * Swap\n * @param  {Object} data    data type can be object or array.\n * @param  {String} pathA   ex: '/menu/nav/list/0'.\n * @param  {String} pathB   ex: '/menu/nav/list/2'.\n * @return {Object}         return data this.\n * @description  `pathA` the data swap `pathB`.\n */\nfunction swap(data, pathA, pathB) {\n  var _a = JsonUri(data, pathA);\n  var _b = JsonUri(data, pathB);\n\n  set(data, pathA, _b);\n  set(data, pathB, _a);\n  return data;\n}\n\n/**\n * Move\n * @param  {Object} data      data type can be object or array.\n * @param  {String} pathA     ex: '/menu/nav/list/0'.\n * @param  {String} pathB     ex: '/menu/nav/list/2'.\n * @param  {String} sequence  ex: 'before', default 'after'.\n * @description Move data in the array.\n */\nfunction mv(data, pathA, pathB) {\n  var direction = arguments.length <= 3 || arguments[3] === undefined ? 'after' : arguments[3];\n\n  var aParent = get(data, pathA + '/../');\n  var bParent = get(data, pathB + '/../');\n  var _a = get(data, pathA);\n  var _b = get(data, pathB);\n  var aIndex = indexOf(pathA);\n  var bIndex = indexOf(pathB);\n\n  /*\n   如果同个数组中移动，要考虑移动后所需要移除的路径（PathA）数据指针有变，\n   所以要判断是同个数组，并且\n   */\n\n  if (aParent !== bParent) {\n    //放入新值\n    insert(data, pathB, _a, direction);\n    //删除PathA\n    rm(data, pathA);\n    return;\n  }\n\n  //移动位置相同直接退出\n  if (aIndex === bIndex) return;\n\n  //放入新值\n  insert(data, pathB, _a, direction);\n\n  //更新bIndex\n  bIndex += direction === 'before' ? -1 : 0;\n\n  //向👈移动aIndex + 1\n  if (bIndex < aIndex) {\n    aIndex++;\n  }\n\n  pathA = normalizePath(pathA, '/../' + aIndex);\n  rm(data, normalizePath(pathA, '/../' + aIndex));\n}\n\n/**\n * Up\n * @param  {Object} data      data type can be object or array.\n * @param  {String} pathA     ex: '/menu/nav/list/0'.\n * @description Move up data in the array.\n */\nfunction up(data, path) {\n  var gap = arguments.length <= 2 || arguments[2] === undefined ? 1 : arguments[2];\n\n  var parent = get(data, path + '/../');\n  var index = indexOf(path);\n  var targetIndex = index - gap;\n  var pathB = normalizePath(path, '/../' + targetIndex + '/');\n\n  if (!isArray(parent)) {\n    console.error('操作的不是数组');\n    return;\n  }\n  //移动溢出\n  if (index <= 0 || index >= parent.length) {\n    return;\n  }\n\n  mv(data, path, pathB, 'before');\n}\n\n/**\n * Down\n * @param  {Object} data      data type can be object or array.\n * @param  {String} pathA     ex: '/menu/nav/list/0'.\n * @description Move up data in the array.\n */\nfunction down(data, path) {\n  var gap = arguments.length <= 2 || arguments[2] === undefined ? 1 : arguments[2];\n\n  var parent = get(data, path + '/../');\n  var index = indexOf(path);\n  var targetIndex = index + gap;\n  var pathB = normalizePath(path, '/../' + targetIndex + '/');\n\n  if (!isArray(parent)) {\n    console.error('操作的不是数组');\n    return;\n  }\n  //移动溢出\n  if (index < 0 || index >= parent.length) {\n    return;\n  }\n\n  mv(data, path, pathB, 'after');\n}\n\n/**\n * 在 path 之前 或者之后插入一个数据, 如果不是数组,控制台报错\n * @param  {[type]} data      [description]\n * @param  {[type]} path      [description]\n * @param  {String} direction [description]\n * @return {[type]}           [description]\n */\nvar max = Math.max;\nvar min = Math.min;\n\n\nfunction insert(data, path, value) {\n  var direction = arguments.length <= 3 || arguments[3] === undefined ? 'after' : arguments[3];\n\n  var parent = get(data, path + '/../');\n  var index = path.split('/').filter(function (item) {\n    return item;\n  }).slice(-1)[0] - 0;\n\n  if (!isInteger(index)) {\n    console.error(path + '不是数字');\n    return;\n  }\n\n  if (!isArray(parent)) {\n    console.error(path + '不是数组');\n    return;\n  }\n\n  var isAfter = direction === 'after';\n  var target = isAfter ? index + 1 : index;\n  target = min(parent.length, target);\n  target = max(0, target);\n  parent.splice(target, 0, value);\n  return data;\n}\n\nvar index = { get: get, set: set, rm: rm, swap: swap, mv: mv, up: up, down: down, insert: insert, walk: walk, normalizePath: normalizePath };\n\nexports['default'] = index;\nexports.get = get;\nexports.set = set;\nexports.rm = rm;\nexports.swap = swap;\nexports.mv = mv;\nexports.up = up;\nexports.down = down;\nexports.insert = insert;\nexports.walk = walk;\nexports.normalizePath = normalizePath;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));"]}