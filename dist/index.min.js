!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).jsonuri={})}(this,function(e){"use strict";var i="is not a natural number",p="must be a Array",c="the parameter is illegal",s="direction must be 'before' | 'after' | 'append'",o="the Index Out of Bounds",r=function(){},l=Array.isArray,h=function(e){return"string"==typeof e},t=function(e){return Number.isInteger(e)},d=function(e){return t(e)&&0<=e},n=/\//,u=function(e){return n.test(e)},v=function(e){var r=typeof e;return null!=e&&("object"==r||"function"==r)},y=function(e){return e+""},k=function(e){console.error(e)},a=function(e,r,n){if(l(e)){if("length"===r){if(!d(n))throw new Error("value: "+n+" "+i);return n>e.length&&(e.length=n),void e.splice(n)}var t=+r;d(t)?(e.length=Math.max(e.length,t),e.splice(t,1,n)):k("key: "+r+" "+i)}else e[r]=n},w=function(e,r){if(l(e)){var n=+r;if(!d(n))return;e.splice(n,1)}else delete e[r]},b=function(e,r,n,t){if(void 0===t&&(t="after"),r<0||r>e.length)throw new Error(o);switch(t){case"before":r-=1;break;case"append":k("TODO")}e.splice(r,0,n)},f="/",g=function(e){var r,n,t=e.path||"";for(e.keys?t||(r=e.keys):r=e.path.split(f),r=r.filter(Boolean);~r.indexOf("");)n=r.indexOf(""),r.splice(n,1);for(;~r.indexOf(".");)n=r.indexOf("."),r.splice(n,1);for(;~r.indexOf("..");)n=r.indexOf(".."),r[n]=r[n-1]="",delete r[n],delete r[n-1],r.splice(n,1),r.splice(n-1,1);return{keys:r,path:r.join(f)}},m=function(e,r){var n,t,i,o;if(r=y(r),!e)return k(c),e;if(""===r)return e;if(!u(r))return e[r];if(!(t=g({path:r}).keys).length)return e;for(i=t.length,o=0;o<i&&null!=(n=(o?n:e)[t[o]]);++o);return n},x=function(e,r,n){var t,i,o,f;if(r=y(r),!e||!r)return k(c);if(!u(r))return a(e,r,n);for(i=0,o=(t=g({path:r}).keys).length;i<o;i++)null==e[f=t[i]]&&(e[f]={}),i===o-1?a(e,f,n):e=e[f]},O=function(e,r){var n,t;r=y(r),e&&r&&(u(r)?(n=m(e,r+"/.."))&&(t=g({path:r}).keys.pop()||"",w(n,t)):w(e,r))},j=function(e,r,n){var t,i;if(r=y(r),n=y(n),!(e&&r&&n&&h(r)&&h(n)))return k(c);t=m(e,r),i=m(e,n),x(e,n,t),x(e,r,i)},E=function(e,r,n,t){var i,o,f;if(r=y(r),!e)return k(c);if(!t)throw new Error(s);if(i=m(e,r+"/.."),!l(i))throw new Error("insert node "+p);f=o=+g({path:r}).keys.pop(),"after"===t?f=o+1:"before"===t&&(f=o),b(i,f,n)},_=Array.prototype,A=function(){var e,r,n=[];for(e=0;e<arguments.length;e++)n[e]=arguments[e];return r=_.concat.apply(_,n).join("/").split("/"),g({keys:r}).path},P=function(e,r,n,t){var i,o,f,u,a,p;if(r=y(r),n=y(n),!(e&&r&&n&&h(r)&&h(n)))return k(c);if(r!==n){if(i=m(e,n),o=m(e,r),f=m(e,n+"/.."),u=+(g({path:r}).keys.pop()||""),a=+(g({path:n}).keys.pop()||""),l(f)){if(!t)throw new Error(s);return p=A(r+"/..")===A(n+"/.."),E(e,n,o,t),p?void w(f,u+(u<a?0:1)):void O(e,r)}if(!v(i))throw new Error("'"+n+"': "+i+" is primitive values");x(e,n+"/"+r,o),O(e,r)}},B=function(e,r,n,t){var i,o,f,u,a;return void 0===t&&(t=1),r=y(r),d(t)&&0<t&&e?(i=m(e,r+"/.."),l(i)?(o=i.length,f=+g({path:r}).keys.pop(),void(!d(f)||o-1<f||((u=f+n*t)<=0&&(u=0),o-1<u&&(u=o-1),a=i[f],w(i,f),b(i,u,a)))):k(p)):k(c)},I=function(e,r,n){B(e,r,-1,n)},M=function(e,r,n){B(e,r,1,n)},z=function(e,r){var n=+g({path:e}).keys.pop();return t(n)?"prev"===r?A(e,"..",n-1):"next"===r?A(e,"..",1+n):null:null},C=function(e,r){var n,t;if(void 0===r&&(r=[]),!v(e))return!1;for(n in r.push(e),e)if(t=e[n],v(t)&&(~r.indexOf(t)||C(t,r.slice())))return!0;return!1},D=function(e,r){var n,t,i,o=!1,f=function(){o=!0};for(n=0,t=Object.keys(e);n<t.length&&(i=t[n],!o);n++)r(e[i],i,e,{_break:f})},N=function(e,u,a){var p,c;if(void 0===e&&(e={}),void 0===u&&(u=r),void 0===a&&(a=r),C(e))throw new Error("obj is a circular structure");return p=[],(c=function(e){return D(e,function(e,r,n,t){var i=t._break,o=!1,f=function(){i(),o=!0,l(n)&&p.pop()};if(p.push(r),u(e,r,n,{path:A(p),_break:f}),p.pop(),v(e)){if(p.push(r),o)return;c(e),p.pop(),a(e,r,n,{path:A(p),_break:f})}}),e})(e)};e._computePath=z,e.down=M,e.get=m,e.insert=E,e.isCircular=C,e.mv=P,e.normalizePath=A,e.rm=O,e.set=x,e.swap=j,e.up=I,e.walk=N,Object.defineProperty(e,"__esModule",{value:!0})});